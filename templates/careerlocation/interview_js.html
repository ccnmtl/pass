{% load careerlocation_state %}

<script src="/site_media/js/json2.js" type="text/javascript" ></script>
<script src="/site_media/js/underscore/underscore-min.js" type="text/javascript" ></script>
<script src="/site_media/js/backbone/backbone-min.js" type="text/javascript" ></script>
<script src="/site_media/js/backbone-tastypie.js" type="text/javascript" ></script>

<script src="/_careerlocation/media/js/interview.js/" type="text/javascript" ></script>

<script type="text/javascript">
    jQuery(document).ready(function () {
        var view = new CareerLocationView({
            current_state_id: '{% get_user_state_id request.user %}',
            view_type: '{{block.view}}',
            el: 'div.career_location'
        });
    });
</script>

<script type="text/template" id="profile-template">
    <img id="x" class="btn cancel" src="/site_media/img/close.png"/>
    <h3><img src="<%= image %>"></img>&nbsp;&nbsp;<%= name %></h3>
    <div>
        <div class="interview left">

            <div><%= profile %></div>
            <br />

            <% if (select_stakeholder) { %>
                <% if (questions.length > 0) { %>
                    <% if (remaining_stakeholders > 0) { %>
                        <div>You must select <%= remaining_stakeholders %>  more stakeholders.</div>
                        <br />

                        <div><b>Do you want to interview <%= name %>?</b></div>

                        <div><button class="btn interview">Yes</button><button class="btn cancel">Not Right Now</button></div>
                    <% } else { %>
                        <div>You've already interviewed 4 stakeholders. Make sure you've asked them each 3 questions!</div>
                        <br />
                    <% } %>
                <% } %>
            <% } else { %>
                <% if (remaining_questions > 0) { %>
                    <div>You've asked <%= response_count %> questions. You must ask <%= remaining_questions %> more.</div>
                <% } else { %>
                    <div>You've completed your interview with <%= name %>.
                        You can review the stakeholder's answers, but you can't ask any more questions.
                        Make sure you've taken good notes!
                    </div>
                <% } %>
                <br />

                <div>
                    <% _.each(questions, function(q, index) { %>
                        <% var asked = false; %>
                        <% _.each(responses, function(r) { if (!asked && q.id === r.attributes.question.attributes.id) { asked = true; } }); %>
                        <div class="accordion-group <% if (index/2 === 0) { %> even <% } %>">
                            <div class="accordion-heading">
                                <div class="question"><%= q.question %></div>
                                <% if (asked) { %>
                                    <button class="btn ask" data-id="<%= q.id %>" <% if (current_question) { %> disabled="disabled" <% } %> >
                                        Asked
                                    </button>
                                <% } else if (remaining_questions <= 0) { %>
                                    <button class="btn asked" data-id="<%= q.id %>" disabled="disabled">
                                        No more questions
                                    </button>
                                <% } else { %>
                                    <button class="btn ask" data-id="<%= q.id %>" <% if (current_question) { %> disabled="disabled" <% } %>>
                                        Ask
                                    </button>
                                <% } %>
                                <div class="visualclear"></div>
                            </div>
                            <% if (current_question && current_question.attributes.id === q.id) { %>
                                <div class="accordion-body" style="display: block">
                            <% } else { %>
                                <div class="accordion-body" style="display: none">
                            <% } %>

                                <div class="accordion-inner">
                                    <%= q.answer %>
                                    <button class="btn done">Close</button>
                                </div>
                            </div>
                            <div class="visualclear"></div>
                        </div>

                    <% }); %>
                </div>
            <% } %>
        </div>
        <div class="interview_notepad right">
            <h4>Your Notepad</h4>
            <textarea class="notepad scrollable"><%= notes %></textarea>
        </div>
    </div>
</script>